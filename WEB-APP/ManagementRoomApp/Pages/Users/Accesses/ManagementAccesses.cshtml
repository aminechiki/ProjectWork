@page
@model ManagementRoomApp.Pages.Accesses.ManagementAccessesModel
@{

}

@section scripts {
<script>

        // Funzione per impostare l'ID utente nella modale
        function openModal(userId) {
            document.getElementById("userId").textContent = userId;
            $('#ModalAddPortPermissionsUser').modal('show');
        }

     
       // console.log("questo : " + i)

        var successi = @Model.SuccessAccesses;
        var fallimenti = @Model.FailureAccesses

    const colors = Highcharts.getOptions().colors.map((c, i) =>
        // Start out with a darkened base color (negative brighten), and end
        // up with a much brighter color
        Highcharts.color(Highcharts.getOptions().colors[0])
            .brighten((i - 3) / 7)
            .get()
    );

    // Build the chart
    Highcharts.chart('container', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: 'Successi e fallimenti ingressi del utente',
            align: 'left'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        accessibility: {
            point: {
                valueSuffix: '%'
            }
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                colors,
                borderRadius: 5,
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b><br>{point.percentage:.1f} %',
                    distance: -50,
                    filter: {
                        property: 'percentage',
                        operator: '>',
                        value: 4
                    }
                }
            }
        },
        series: [{
            name: 'Share',
                colors: ['#2ECC71', '#E74C3C'],
            data: [
                    { name: 'SUCCESSI', y: successi },
                    { name: 'FALLIMENTI', y: fallimenti },
            ]
        }]
    });



    /*
        window.addEventListener('DOMContentLoaded', function () {
            sortTable();
        });

        function sortTable() {
            const table = document.getElementById("tableUser");
            const rows = Array.from(table.querySelectorAll("tr")).slice(1); // Exclude the header row


            rows.sort(function (a, b) {
                const dateA = new Date(a.cells[1].textContent);
                const dateB = new Date(b.cells[1].textContent);

                return dateA - dateB; // Ascending order
                // To sort in descending order, use: return dateB - dateA;
            });

            
            while (table.rows.length > 1) {
                table.deleteRow(1); // Remove all rows except the header
            }
            
            
            rows.forEach(function (row) {
                table.appendChild(row);
            });
          

        }

        */
</script>
}


<div">
    <h1>@ViewData["Title"]</h1>
    </div>
    <section class="intro">
        <div class="container">
            <div class="row justify-content-center">
                <div class="card-body p-0">
                    <div class="scrollit" style="position: relative">
                        <a class="btn btn-secondary" href="/Users/ManagementUsers" style="margin-bottom:15px"><b>TORNA ALLA GESTIONE UTENTI</b></a>
                        <button class="btn btn-secondary" onclick="openModal('')" style="margin-bottom:15px"><b>ANALISI ACCESSI E FALLIMENTI</b></button>
                        <table id="tableUser" class="table table-striped table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">PORTA</th>
                                    <th scope="col">EDIFICIO</th>
                                    <th scope="col">DATA</th>
                                    <th scope="col">SUCCESS</th>
                                </tr>
                            </thead>
                            <tbody>
        @foreach (var accesses in Model.Accesses)
        {
            if (@accesses.Success)
            {
                                        <tr style="background-color:#2ECC71">
                                            <td>@accesses.NameDoor</td>
                                            <td>@accesses.Description</td>
                                            <td>@accesses.Date</td>
                                            <td>@accesses.Success</td>
                                        </tr>
            }
            else
            {
                                        <tr style="background-color:#E74C3C">
                                            <td>@accesses.NameDoor</td>
                                            <td>@accesses.Description</td>
                                            <td>@accesses.Date</td>
                                            <td>@accesses.Success</td>
                                        </tr>
            }

        }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Modal Add Port Permissions User -->
    <div class="modal" id="ModalAddPortPermissionsUser" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <span hidden id="userId"></span>

                    <section class="intro">
                        <div class="container">
                            <div class="row justify-content-center">

                                <div class="card-body p-0">

                                    <div data-mdb-perfect-scrollbar="true" style="position: relative">
                                        <div id="myDIV" style="margin-bottom:30px; border-style: solid; border-radius: 25px;">

                                            <div style="padding: 2px 10px 10px 10px;">

                                                <figure class="highcharts-figure">
                                                    <div id="container"></div>

                                                </figure>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>


